<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web scraping with morph.io - Chris Mytton</title>

    <meta property="og:title" content="Web scraping with morph.io" />
    <meta name="author" content="Chris Mytton" />
    <meta property="og:locale" content="en_GB" />
    <meta name="description" content="" />
    <meta property="og:description" content="" />
    <link rel="canonical" href="https://www.chrismytton.com/2015/02/06/web-scraping-with-morph-io/" />
    <meta property="og:url" content="https://www.chrismytton.com/2015/02/06/web-scraping-with-morph-io/" />
    <meta property="og:site_name" content="Chris Mytton" />
    
    <meta property="og:image" content="https://www.chrismytton.com/assets/images/profile-October-2019-square.jpg">
    <meta name="twitter:card" content="summary" />
    
    <meta property="twitter:title" content="Web scraping with morph.io" />
    <meta name="twitter:site" content="@chrismytton" />
    <meta name="twitter:creator" content="@chrismytton" />

    <link rel="stylesheet" href="/assets/css/main.css?1600799571">
    <link type="application/atom+xml" rel="alternate" href="/index.xml" title="Chris Mytton" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.png">

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58688654-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-58688654-2');
    </script>
  </head>

  <body>

    <div class="container">
      <header class="site-header clearfix">
        <a class="logo" href="/">Chris Mytton</a>
        <div class="menu">
          <a href="/">Home</a>
          <a href="/articles/">Articles</a>
          <a href="/tags/">Tags</a>
        </div>
      </header>

      <main class="site-content">
        <header class="post-header">
  <h1 class="post-title">Web scraping with morph.io</h1>
  <p class="post-date">Friday 6 February 2015</p>
</header>

<article class="post">

  <div class="post-content">
    
<p>If you’ve followed along my previous two blog posts, <a href="/2015/01/19/web-scraping-with-ruby/">Web Scraping with Ruby</a> and <a href="/2015/01/22/advanced-web-scraping-with-mechanize/">Advanced web scraping with Mechanize</a> then you’ll now have the knowledge needed to write a basic web scraper for getting structured data from the web.</p>

<p>The next logical step is to actually run these scrapers regularly so you can get information that’s constantly up-to-date. This is where the excellent <a href="https://morph.io/">morph.io</a> from the talented folks at <a href="https://www.openaustraliafoundation.org.au/">OpenAustralia</a> comes into play.</p>

<p>Morph.io bills itself as “A Heroku for Scrapers”.  You can choose to either run your scrapers manually, or have them run automatically for you every day. Then you can use the morph.io API to extract the data for use in your application as JSON, CSV or you can download a sqlite database containing the scraped data.</p>

<p>Morph.io fills the gap that <a href="https://classic.scraperwiki.com/">Scraperwiki Classic</a> left. Morph.io scrapers are hosted on GitHub, which means you can fork them and fix them if they break in the future.</p>

<h2 id="creating-a-scraper">Creating a scraper</h2>

<p>We’ll use the code from the <a href="/2015/01/22/advanced-web-scraping-with-mechanize/#all-together-now">Pitchfork Scraper</a> in my previous post to demonstrate how easy it is to get your scraper running on morph.io.</p>

<p>You can sign into morph.io with a GitHub account. Once signed in you can then <a href="https://morph.io/scrapers/new">create a scraper</a>. Currently morph.io supports scrapers written in Ruby, PHP, Python or Perl, choose a language and give your scraper a name, I’m calling mine <code>pitchfork_scraper</code>. Then press the “Create Scraper” button to create a new GitHub repository containing skeleton code for a scraper in your chosen language.</p>

<p>Clone the repository that was created in the previous step, in my case I can use the following:</p>

<pre><code>git clone https://github.com/chrismytton/pitchfork_scraper
</code></pre>

<p>The repository will contain a <code>README.md</code> and a <code>scraper.rb</code> file.</p>

<p>Morph.io expects two things from your scraper. First the scraper repository should contain a <code>scraper.rb</code> file for Ruby scrapers <sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>, second the scraper itself should write to a sqlite3 database file called <code>data.sqlite</code>. In order to change this in our scraper we need to make a small change so it writes to a database rather than to JSON on STDOUT.</p>

<p>First add the <a href="/2015/01/22/advanced-web-scraping-with-mechanize/#all-together-now">code from the previous post</a> into <code>scraper.rb</code>, then you can change the code to use the <code>scraperwiki</code> gem to write to the sqlite database.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/scraper.rb b/scraper.rb
index 2d2baaa..f8b14d6 100644
</span><span class="gd">--- a/scraper.rb
</span><span class="gi">+++ b/scraper.rb
</span><span class="p">@@ -1,6 +1,8 @@</span>
 require 'mechanize'
 require 'date'
<span class="gd">-require 'json'
</span><span class="gi">+require 'scraperwiki'
+
+ScraperWiki.config = { db: 'data.sqlite', default_table_name: 'data' }
</span>
 agent = Mechanize.new
 page = agent.get("http://pitchfork.com/reviews/albums/")
<span class="p">@@ -34,4 +36,6 @@</span> reviews = review_links.map do |link|
   }
 end

-puts JSON.pretty_generate(reviews)
<span class="gi">+reviews.each do |review|
+  ScraperWiki.save_sqlite([:artist, :album], review)
+end
</span></code></pre></div></div>

<p>This uses the <code>ScraperWiki.save_sqlite</code> method to save the review in the database. The first argument is the list of fields that in combination should be considered unique. In this case we’re using the artist and album, since it’s unlikely that an artist would release two albums with the same name.</p>

<p>You’ll need to install the Ruby <code>scraperwiki</code> gem in addition to the other dependencies to run this code locally.</p>

<pre><code>gem install scraperwiki
</code></pre>

<p>Then you can run this code on your local machine with the following:</p>

<pre><code>ruby scraper.rb
</code></pre>

<p>This will create a new file in the current directory called <code>data.sqlite</code> which will contain the scraped data.</p>

<h2 id="running-the-scraper-on-morphio">Running the scraper on morph.io</h2>

<p>Now you’ve made the changes to your scraper you can run the code on <a href="https://morph.io/">morph.io</a>. First commit your changes using <code>git</code>. Then <code>git push</code> the changes to the scrapers GitHub repository.</p>

<p>You can then run the scraper and the results should be added to the corresponding sqlite database on morph.io. It should look something like the following:</p>

<p><img src="/assets/images/pitchfork_scraper.png" alt="Screenshot of morph.io output" /></p>

<p>As you can see the data is now available to authorized users as either JSON, CSV or you can download the sqlite database and use that locally.</p>

<p>The code for the scraper is <a href="https://github.com/chrismytton/pitchfork_scraper">available on GitHub</a>. You can see the output from the scraper on morph.io <a href="https://morph.io/chrismytton/pitchfork_scraper">morph.io/chrismytton/pitchfork_scraper</a>. Note that you’ll need to sign in with GitHub in order to access and manipulate the data over the API.</p>

<p>This article should give you enough background to start hosting your scrapers on <a href="https://morph.io/">morph.io</a>. In my opinion it’s an awesome service that takes the hassle out of running and maintaining scrapers and leaves you to concentrate on the unique parts of your application.</p>

<p>Go forth and get structured data out of the web!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Alternatively <code>scraper.py</code> for Python, <code>scraper.php</code> for PHP or <code>scraper.pl</code> for Perl <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="post-tags">
    <p>
      Tagged:
      
      <a href="/tags/#programming">#programming</a>
      
      <a href="/tags/#scraping">#scraping</a>
      
    </p>
  </div>

</article>

      </main>
    </div>

    <footer class="container site-footer">
      <a class="logo" href="/">Chris Mytton</a>
      <p class="footer-links">
        Explore:
        <a href="/articles/">Articles</a> &middot;
        <a href="/tags/">Tags</a>
      </p>
      <p class="footer-links">
        Contact:
        <a href="mailto:mail@chrismytton.com">Email</a>
      </p>
      <img class="profile rounded" alt="chrismytton" width="100" height="100" src="/assets/images/profile-October-2019-square.jpg"/>

<div class="mini-bio">
  <p>
    Hi! My name is Chris. I'm a Senior Developer at <a href="https://www.mysociety.org/">mySociety</a>. I'm currently working on <a href="https://fixmystreet.org">FixMyStreet</a>, a software platform for reporting local problems.
  </p>
  <p>
    This is my personal website where I share projects I've been working on and what I learn along the way.
  </p>
  <p>
    You can also find me on&nbsp;<a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/chrismytton" aria-label="Visit my Twitter">Twitter</a>.
  </p>
</div>

      <div class="elsewhere">
        <a target="_blank" rel="noopener noreferrer" href="/index.xml" aria-label="Subscribe to my feed">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 400 400"><path fill="currentColor" fill-rule="evenodd" d="M201.8 347.2c0 20.3-16.5 36.8-36.8 36.8 -20.3 0-36.8-16.5-36.8-36.8s16.5-36.8 36.8-36.8C185.3 310.4 201.8 326.8 201.8 347.2zM128.2 204.7v54.5c68.5 0.7 124 56.3 124.7 124.7h54.5C306.7 285.3 226.9 205.4 128.2 204.7zM128.2 166.6c57.9 0.3 112.3 22.9 153.2 63.9 41 41 63.7 95.5 63.9 153.5h54.5c-0.3-149.9-121.7-271.4-271.6-271.9V166.6L128.2 166.6z"></path></svg>
        </a>
        <a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/chrismytton" aria-label="Visit my Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="20" viewBox="0 0 24 20"><path fill="currentColor" fill-rule="evenodd" d="M24,2.96470588 C23.1,3.40941176 22.2,3.55764706 21.15,3.70588235 C22.2,3.11294118 22.95,2.22352941 23.25,1.03764706 C22.35,1.63058824 21.3,1.92705882 20.1,2.22352941 C19.2,1.33411765 17.85,0.741176471 16.5,0.741176471 C13.95,0.741176471 11.7,2.96470588 11.7,5.63294118 C11.7,6.07764706 11.7,6.37411765 11.85,6.67058824 C7.8,6.52235294 4.05,4.59529412 1.65,1.63058824 C1.2,2.37176471 1.05,3.11294118 1.05,4.15058824 C1.05,5.78117647 1.95,7.26352941 3.3,8.15294118 C2.55,8.15294118 1.8,7.85647059 1.05,7.56 C1.05,7.56 1.05,7.56 1.05,7.56 C1.05,9.93176471 2.7,11.8588235 4.95,12.3035294 C4.5,12.4517647 4.05,12.4517647 3.6,12.4517647 C3.3,12.4517647 3,12.4517647 2.7,12.3035294 C3.3,14.2305882 5.1,15.7129412 7.35,15.7129412 C5.7,17.0470588 3.6,17.7882353 1.2,17.7882353 C0.75,17.7882353 0.45,17.7882353 0,17.7882353 C2.25,19.1223529 4.8,20.0117647 7.5,20.0117647 C16.5,20.0117647 21.45,12.6 21.45,6.22588235 C21.45,6.07764706 21.45,5.78117647 21.45,5.63294118 C22.5,4.89176471 23.4,4.00235294 24,2.96470588 Z"></path></svg>
        </a>
        <a target="_blank" rel="noopener noreferrer me" href="https://github.com/chrismytton" aria-label="Visit my GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 23 23"><path fill="currentColor" fill-rule="evenodd" d="M11.2941176,0.279031142 C5.08235294,0.279031142 0,5.3015917 0,11.4402768 C0,16.3233218 3.24705882,20.5087889 7.76470588,22.0434602 C8.32941176,22.1829758 8.47058824,21.7644291 8.47058824,21.4853979 C8.47058824,21.2063668 8.47058824,20.5087889 8.47058824,19.5321799 C5.36470588,20.2297578 4.65882353,18.1370242 4.65882353,18.1370242 C4.09411765,16.8813841 3.38823529,16.4628374 3.38823529,16.4628374 C2.4,15.7652595 3.52941176,15.7652595 3.52941176,15.7652595 C4.65882353,15.9047751 5.22352941,16.8813841 5.22352941,16.8813841 C6.21176471,18.6950865 7.90588235,18.1370242 8.47058824,17.8579931 C8.61176471,17.1604152 8.89411765,16.6023529 9.17647059,16.3233218 C6.63529412,16.0442907 4.09411765,15.0676817 4.09411765,10.742699 C4.09411765,9.48705882 4.51764706,8.51044983 5.22352941,7.81287197 C5.08235294,7.53384083 4.65882353,6.41771626 5.36470588,4.88304498 C5.36470588,4.88304498 6.35294118,4.60401384 8.47058824,5.99916955 C9.31764706,5.72013841 10.3058824,5.58062284 11.2941176,5.58062284 C12.2823529,5.58062284 13.2705882,5.72013841 14.1176471,5.99916955 C16.2352941,4.60401384 17.2235294,4.88304498 17.2235294,4.88304498 C17.7882353,6.41771626 17.5058824,7.53384083 17.3647059,7.81287197 C18.0705882,8.6499654 18.4941176,9.62657439 18.4941176,10.742699 C18.4941176,15.0676817 15.8117647,15.9047751 13.2705882,16.1838062 C13.6941176,16.7418685 14.1176471,17.4394464 14.1176471,18.4160554 C14.1176471,19.9507266 14.1176471,21.0668512 14.1176471,21.4853979 C14.1176471,21.7644291 14.2588235,22.1829758 14.9647059,22.0434602 C19.4823529,20.5087889 22.7294118,16.3233218 22.7294118,11.4402768 C22.5882353,5.3015917 17.5058824,0.279031142 11.2941176,0.279031142 Z"></path></svg>
        </a>
      </div>
    </footer>

  </body>

</html>
