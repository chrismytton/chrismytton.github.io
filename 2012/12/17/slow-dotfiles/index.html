<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Slow dotfiles - Chris Mytton</title>

    <meta property="og:title" content="Slow dotfiles" />
    <meta name="author" content="Chris Mytton" />
    <meta property="og:locale" content="en_GB" />
    <meta name="description" content="" />
    <meta property="og:description" content="" />
    <link rel="canonical" href="https://www.chrismytton.com/2012/12/17/slow-dotfiles/" />
    <meta property="og:url" content="https://www.chrismytton.com/2012/12/17/slow-dotfiles/" />
    <meta property="og:site_name" content="Chris Mytton" />
    
    <meta property="og:image" content="https://www.chrismytton.com/assets/images/profile-October-2019-square.jpg">
    <meta name="twitter:card" content="summary" />
    
    <meta property="twitter:title" content="Slow dotfiles" />
    <meta name="twitter:site" content="@chrismytton" />
    <meta name="twitter:creator" content="@chrismytton" />

    <link rel="stylesheet" href="/assets/css/main.css?1600929516">
    <link type="application/atom+xml" rel="alternate" href="/index.xml" title="Chris Mytton" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.png">

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58688654-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-58688654-2');
    </script>
  </head>

  <body>

    <div class="container">
      <header class="site-header clearfix">
        <a class="logo" href="/">Chris Mytton</a>
        <div class="menu">
          <a href="/">Home</a>
          <a href="/articles/">Articles</a>
          <a href="/tags/">Tags</a>
        </div>
      </header>

      <main class="site-content">
        <header class="post-header">
  <h1 class="post-title">Slow dotfiles</h1>
  <p class="post-date">Monday 17 December 2012</p>
</header>

<article class="post">

  <div class="post-content">
    
<p>For a while now my shell has been taking a <em>very</em> long time to start up. It
wasn’t so noticeable on more powerful machines, but on my late 2010
MacBook Air with “only” 2GB of RAM, it was very noticeable.</p>

<p>Last weekend I decided to finally sit down and figure out what was causing the
slow startup times. I stepped through the startup process in my <a href="https://github.com/chrismytton/dotfiles">dotfiles</a>,
commenting out lines until it was fast again, it didn’t take long to find
the offending line in my <code>zshrc</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>module <span class="o">(</span><span class="nv">$DOTFILES</span>/<span class="k">**</span>/<span class="k">*</span>.zsh<span class="o">)</span> <span class="nb">source</span> <span class="s2">"</span><span class="nv">$module</span><span class="s2">"</span>
</code></pre></div></div>

<p>This line uses shell globbing to load up all the files that end in <code>.zsh</code> in
the dotfiles repo, its pretty central to the way the dotfiles work, without
it no custom zsh scripts are loaded. So how could this line be causing such
a slow startup?</p>

<p>The way <a href="http://en.wikipedia.org/wiki/Glob_(programming)">globbing</a> works is it expands the pattern into a list of
files. In this case it checks all the files in the dotfiles directory to
see if they end with <code>.zsh</code>.</p>

<p>This shouldn’t be a problem, but I had configured my vim plugins
to be installed into a directory within the dotfiles repo, which had its
contents gitignored, you can see <a href="https://github.com/chrismytton/dotfiles/commit/5c497a86f3535bad6c31a93a617598879fc9cd58">the commit</a> on GitHub. This meant I
could install vim plugins without having to track them in the repo. So
the shell globbing was checking all of the files in the vim plugins as
well as the dotfiles.</p>

<p>To solve this problem I spent an hour removing my vim configuration from my dotfiles and putting it
into its <a href="https://github.com/chrismytton/dotvim">own repository</a>. I’d wanted to do this for a while anyway because I found myself
changing my vim configuration a lot more than anything else in the dotfiles.</p>

<p>I made this change on my faster work laptop, which doesn’t suffer as much with the
slow startup. When I got round to pulling the
changes down to my Air the difference was <em>very</em> noticeable, new
shells pop into existence in under a second, like they should.</p>

<p>It’s been 6 months since I made the commit which began the slowdown. I’ve been putting up with
slow shell startups for all that time, when actually it only took a
couple of hours in total to identify and fix the problem.</p>

<p>So don’t be like me and ignore performance problems when you know
they’re there, take the time to fix them</p>


  </div>

  <div class="post-tags">
    <p>
      Tagged:
      
      <a href="/tags/#programming">#programming</a>
      
    </p>
  </div>

</article>

      </main>
    </div>

    <footer class="container site-footer">
      <a class="logo" href="/">Chris Mytton</a>
      <p class="footer-links">
        Explore:
        <a href="/articles/">Articles</a> &middot;
        <a href="/tags/">Tags</a>
      </p>
      <p class="footer-links">
        Contact:
        <a href="mailto:mail@chrismytton.com">Email</a>
      </p>
      <img class="profile rounded" alt="chrismytton" width="100" height="100" src="/assets/images/profile-October-2019-square.jpg"/>

<div class="mini-bio">
  <p>
    Hi! My name is Chris. I'm a Senior Developer at <a href="https://www.mysociety.org/">mySociety</a>. I'm currently working on <a href="https://fixmystreet.org">FixMyStreet</a>, a software platform for reporting local problems.
  </p>
  <p>
    This is my personal website where I share projects I've been working on and what I learn along the way.
  </p>
  <p>
    You can also find me on&nbsp;<a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/chrismytton" aria-label="Visit my Twitter">Twitter</a>.
  </p>
</div>

      <div class="elsewhere">
        <a target="_blank" rel="noopener noreferrer me" href="https://twitter.com/chrismytton" aria-label="Visit my Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>
        </a>
        <a target="_blank" rel="noopener noreferrer me" href="https://github.com/chrismytton" aria-label="Visit my GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
        <a target="_blank" rel="noopener noreferrer" href="/index.xml" aria-label="Subscribe to my feed">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
        </a>
      </div>
    </footer>

  </body>

</html>
