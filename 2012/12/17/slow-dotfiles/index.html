<!DOCTYPE html>
<html lang="en" class="bg-zinc-50 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-50 font-serif">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Slow dotfiles – Chris Mytton</title>

    <meta property="og:title" content="Slow dotfiles">
    <meta name="author" content="Chris Mytton">
    <meta property="og:locale" content="en_GB">
    <meta name="description" content="This is my personal website where I share anything I find interesting. Follow me on Twitter: @chrismytton">
    <meta property="og:description" content="This is my personal website where I share anything I find interesting. Follow me on Twitter: @chrismytton">
    <link rel="canonical" href="https://www.chrismytton.com/2012/12/17/slow-dotfiles/">
    <meta property="og:url" content="https://www.chrismytton.com/2012/12/17/slow-dotfiles/">
    <meta property="og:site_name" content="Chris Mytton">
    
    <meta property="og:image" content="https://www.chrismytton.com/assets/images/profile-October-2019-square.jpg">
    <meta property="twitter:image" content="https://www.chrismytton.com/assets/images/profile-October-2019-square.jpg">
    
    <meta name="twitter:card" content="summary">
    <meta property="twitter:title" content="Slow dotfiles">
    <meta name="twitter:site" content="@chrismytton">
    <meta name="twitter:creator" content="@chrismytton">

    <link href="/tailwind.css" rel="stylesheet">
    <link href="/syntax-highlighting.css" rel="stylesheet">
    <link href="/lite-yt-embed.css" rel="stylesheet">
    <link type="application/atom+xml" rel="alternate" href="/index.xml" title="Chris Mytton">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.png">
    <script type="speculationrules">
    {
      "prerender": [{
        "where": {
          "href_matches": "/*"
        },
        "eagerness": "moderate"
      }]
    }
    </script>
    <script src="/lite-yt-embed.js"></script>
  </head>

  <body class="container mx-auto px-6 py-10 mb-10">
    <div class="mx-auto max-w-prose">
      <header class="pb-8 mb-6 border-b border-zinc-200 dark:border-zinc-700">
        <div class="flex flex-wrap gap-4 items-center mb-6">
          <a class="mr-auto font-display font-semibold text-4xl text-accent hover:text-accent-hover transition-colors" href="/">Chris Mytton</a>

          <div class="flex flex-wrap gap-3">
  <a class="hover:text-[#ff0000] transition-colors duration-200" target="_blank" rel="noopener noreferrer me" href="https://www.youtube.com/chrismytton" title="Subscribe to my YouTube channel" aria-label="Subscribe to my YouTube channel">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="currentColor" d="M23,9.71a8.5,8.5,0,0,0-.91-4.13,2.92,2.92,0,0,0-1.72-1A78.36,78.36,0,0,0,12,4.27a78.45,78.45,0,0,0-8.34.3,2.87,2.87,0,0,0-1.46.74c-.9.83-1,2.25-1.1,3.45a48.29,48.29,0,0,0,0,6.48,9.55,9.55,0,0,0,.3,2,3.14,3.14,0,0,0,.71,1.36,2.86,2.86,0,0,0,1.49.78,45.18,45.18,0,0,0,6.5.33c3.5.05,6.57,0,10.2-.28a2.88,2.88,0,0,0,1.53-.78,2.49,2.49,0,0,0,.61-1,10.58,10.58,0,0,0,.52-3.4C23,13.69,23,10.31,23,9.71ZM9.74,14.85V8.66l5.92,3.11C14,12.69,11.81,13.73,9.74,14.85Z"/></svg>
  </a>
  
  <a class="hover:opacity-70 transition-opacity duration-200" target="_blank" rel="noopener noreferrer me" href="https://github.com/chrismytton" title="Visit my GitHub" aria-label="Visit my GitHub">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
  </a>
  <a class="hover:text-[#ee802f] transition-colors duration-200" target="_blank" rel="noopener noreferrer" href="/index.xml" title="Subscribe to my feed" aria-label="Subscribe to my feed">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="currentColor" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
  </a>
</div>

        </div>
        <div class="flex flex-wrap gap-5 text-xl font-sans">
  <a class="link-subtle" href="/">Home</a>
  <a class="link-subtle" href="/articles/">Articles</a>
  <a class="link-subtle" href="/videos/">Videos</a>
</div>

      </header>

      <main class="mb-20">
        <div class="post">
  <article class="mx-auto prose prose-zinc dark:prose-invert prose-h1:font-display prose-h1:font-semibold prose-h2:font-display prose-h2:font-semibold prose-h3:font-display prose-h3:font-medium prose-a:text-accent prose-a:no-underline hover:prose-a:text-accent-hover prose-a:transition-colors">
    <header class="post-header mb-8 mt-8">
      <h1 class="post-title mb-2 text-pretty">Slow dotfiles</h1>
      <p class="text-zinc-600 dark:text-zinc-400 text-sm font-sans not-prose">Published 17 December 2012</p>
    </header>

    <div class="post-content">
      
<p>For a while now my shell has been taking a <em>very</em> long time to start up. It
wasn’t so noticeable on more powerful machines, but on my late 2010
MacBook Air with “only” 2GB of RAM, it was very noticeable.</p>

<p>Last weekend I decided to finally sit down and figure out what was causing the
slow startup times. I stepped through the startup process in my <a href="https://github.com/chrismytton/dotfiles">dotfiles</a>,
commenting out lines until it was fast again, it didn’t take long to find
the offending line in my <code>zshrc</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>module <span class="o">(</span><span class="nv">$DOTFILES</span>/<span class="k">**</span>/<span class="k">*</span>.zsh<span class="o">)</span> <span class="nb">source</span> <span class="s2">"</span><span class="nv">$module</span><span class="s2">"</span>
</code></pre></div></div>

<p>This line uses shell globbing to load up all the files that end in <code>.zsh</code> in
the dotfiles repo, its pretty central to the way the dotfiles work, without
it no custom zsh scripts are loaded. So how could this line be causing such
a slow startup?</p>

<p>The way <a href="http://en.wikipedia.org/wiki/Glob_(programming)">globbing</a> works is it expands the pattern into a list of
files. In this case it checks all the files in the dotfiles directory to
see if they end with <code>.zsh</code>.</p>

<p>This shouldn’t be a problem, but I had configured my vim plugins
to be installed into a directory within the dotfiles repo, which had its
contents gitignored, you can see <a href="https://github.com/chrismytton/dotfiles/commit/5c497a86f3535bad6c31a93a617598879fc9cd58">the commit</a> on GitHub. This meant I
could install vim plugins without having to track them in the repo. So
the shell globbing was checking all of the files in the vim plugins as
well as the dotfiles.</p>

<p>To solve this problem I spent an hour removing my vim configuration from my dotfiles and putting it
into its own repository. I’d wanted to do this for a while anyway because I found myself
changing my vim configuration a lot more than anything else in the dotfiles.</p>

<p>I made this change on my faster work laptop, which doesn’t suffer as much with the
slow startup. When I got round to pulling the
changes down to my Air the difference was <em>very</em> noticeable, new
shells pop into existence in under a second, like they should.</p>

<p>It’s been 6 months since I made the commit which began the slowdown. I’ve been putting up with
slow shell startups for all that time, when actually it only took a
couple of hours in total to identify and fix the problem.</p>

<p>So don’t be like me and ignore performance problems when you know
they’re there, take the time to fix them. Sometimes the best course of action is to <a href="/2012/12/09/removing-code/">remove some code</a>.</p>


    </div>

    <footer class="mt-12 pt-6 not-prose">
      
        <div class="post-tags">
          <p class="text-sm text-zinc-600 dark:text-zinc-400 font-sans">
            
            <a class="text-accent hover:text-accent-hover transition-colors" href="/tags/#programming">#programming</a>
            
          </p>
        </div>
      
    </footer>

  </article>

</div>

      </main>

      <footer class="mt-20 pt-10 border-t border-zinc-200 dark:border-zinc-700">
        <div class="flex items-center mb-6">
          <a class="mr-auto font-display font-semibold text-4xl text-accent hover:text-accent-hover transition-colors" href="/">Chris Mytton</a>

        </div>
        <div class="flex flex-wrap gap-5 text-xl font-sans">
  <a class="link-subtle" href="/">Home</a>
  <a class="link-subtle" href="/articles/">Articles</a>
  <a class="link-subtle" href="/videos/">Videos</a>
</div>

      </footer>
    </div>

  </body>

</html>
