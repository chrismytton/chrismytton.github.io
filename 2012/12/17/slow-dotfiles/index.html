<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Slow dotfiles - Chris Mytton</title>

    <meta property="og:title" content="Slow dotfiles" />
    <meta name="author" content="Chris Mytton" />
    <meta property="og:locale" content="en_GB" />
    <meta name="description" content="I'm a Senior Developer at mySociety. This is my personal website." />
    <meta property="og:description" content="I'm a Senior Developer at mySociety. This is my personal website." />
    <link rel="canonical" href="https://www.chrismytton.uk/2012/12/17/slow-dotfiles/" />
    <meta property="og:url" content="https://www.chrismytton.uk/2012/12/17/slow-dotfiles/" />
    <meta property="og:site_name" content="Chris Mytton" />
    
    <meta property="og:image" content="/assets/images/profile-October-2019-square.jpg">
    <meta name="twitter:card" content="summary" />
    
    <meta property="twitter:title" content="Slow dotfiles" />
    <meta name="twitter:site" content="@chrismytton" />
    <meta name="twitter:creator" content="@chrismytton" />

    <link rel="stylesheet" href="/assets/css/main.css?1593519469">
    <link type="application/atom+xml" rel="alternate" href="/index.xml" title="Chris Mytton" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.png">
  </head>

  <body>

    <div class="container">
      <header class="site-header clearfix">
        <a class="logo" href="/">Chris Mytton</a>
        <div class="menu">
          <a href="/">Home</a>
          <a href="/articles/">Articles</a>
          <a href="/tags/">Tags</a>
          <a href="https://twitter.com/chrismytton" rel="me">Twitter</a>
          <a href="https://github.com/chrismytton" rel="me">GitHub</a>
          <a href="mailto:mail@chrismytton.uk">Email me</a>
        </div>
      </header>

      <main class="site-content">
        <header class="post-header">
  <h1 class="post-title">Slow dotfiles</h1>
  <p class="post-date">Monday 17 December 2012</p>
</header>

<article class="post">

  <div class="post-content">
    
<p>For a while now my shell has been taking a <em>very</em> long time to start up. It
wasn’t so noticeable on more powerful machines, but on my late 2010
MacBook Air with “only” 2GB of RAM, it was very noticeable.</p>

<p>Last weekend I decided to finally sit down and figure out what was causing the
slow startup times. I stepped through the startup process in my <a href="https://github.com/chrismytton/dotfiles">dotfiles</a>,
commenting out lines until it was fast again, it didn’t take long to find
the offending line in my <code>zshrc</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>module <span class="o">(</span><span class="nv">$DOTFILES</span>/<span class="k">**</span>/<span class="k">*</span>.zsh<span class="o">)</span> <span class="nb">source</span> <span class="s2">"</span><span class="nv">$module</span><span class="s2">"</span>
</code></pre></div></div>

<p>This line uses shell globbing to load up all the files that end in <code>.zsh</code> in
the dotfiles repo, its pretty central to the way the dotfiles work, without
it no custom zsh scripts are loaded. So how could this line be causing such
a slow startup?</p>

<p>The way <a href="http://en.wikipedia.org/wiki/Glob_(programming)">globbing</a> works is it expands the pattern into a list of
files. In this case it checks all the files in the dotfiles directory to
see if they end with <code>.zsh</code>.</p>

<p>This shouldn’t be a problem, but I had configured my vim plugins
to be installed into a directory within the dotfiles repo, which had its
contents gitignored, you can see <a href="https://github.com/chrismytton/dotfiles/commit/5c497a86f3535bad6c31a93a617598879fc9cd58">the commit</a> on GitHub. This meant I
could install vim plugins without having to track them in the repo. So
the shell globbing was checking all of the files in the vim plugins as
well as the dotfiles.</p>

<p>To solve this problem I spent an hour removing my vim configuration from my dotfiles and putting it
into its <a href="https://github.com/chrismytton/dotvim">own repository</a>. I’d wanted to do this for a while anyway because I found myself
changing my vim configuration a lot more than anything else in the dotfiles.</p>

<p>I made this change on my faster work laptop, which doesn’t suffer as much with the
slow startup. When I got round to pulling the
changes down to my Air the difference was <em>very</em> noticeable, new
shells pop into existence in under a second, like they should.</p>

<p>It’s been 6 months since I made the commit which began the slowdown. I’ve been putting up with
slow shell startups for all that time, when actually it only took a
couple of hours in total to identify and fix the problem.</p>

<p>So don’t be like me and ignore performance problems when you know
they’re there, take the time to fix them</p>


  </div>

  <div class="post-tags">
    <p>
      Tagged:
      
      <a href="/tags/#programming">#programming</a>
      
    </p>
  </div>

</article>

      </main>
    </div>

    <footer class="container site-footer">
      <a class="logo" href="/">Chris Mytton</a>
      <p class="footer-links">
        Explore:
        <a href="/articles/">Articles</a> &middot;
        <a href="/tags/">Tags</a>
      </p>
      <p class="footer-links">
        Elsewhere:
        <a href="https://twitter.com/chrismytton" rel="me">Twitter</a> &middot;
        <a href="https://github.com/chrismytton" rel="me">GitHub</a>
      </p>
      <p class="footer-links">
        Contact:
        <a href="mailto:mail@chrismytton.uk">Email</a>
      </p>
      <p class="footer-links">
        Subscribe:
        <a href="/index.xml">RSS feed</a>
      </p>
      <img class="profile rounded" alt="chrismytton" width="100" height="100" src="/assets/images/profile-October-2019-square.jpg"/>

<div class="mini-bio">
  <p>
    Hi! My name is Chris. I'm a Senior Developer at <a href="https://www.mysociety.org/">mySociety</a>. I'm currently working on <a href="https://fixmystreet.org">FixMyStreet</a>, a software platform for reporting local problems.
  </p>
  <p>
    This is my personal website where I share projects I've been working on and what I learn along the way.
  </p>
  <p>
    You can also find me on&nbsp;<a href="https://twitter.com/chrismytton" rel="me">Twitter</a>.
  </p>
</div>

    </footer>

  </body>

</html>
